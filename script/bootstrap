#!/usr/bin/env bash
# script/bootstrap: Resolve all dependencies for development environment.

set -e

cd "$(dirname "$0")/.."

echo "==> Installing prek (pre-commit replacement)..."
if command -v prek &> /dev/null; then
    echo "    prek already installed: $(prek --version 2>&1 | head -1)"
else
    if command -v pip3 &> /dev/null; then
        pip3 install --quiet prek
    elif command -v pip &> /dev/null; then
        pip install --quiet prek
    else
        echo "    ERROR: pip not found. Please install pip to continue."
        exit 1
    fi
    echo "    prek installed: $(prek --version 2>&1 | head -1)"
fi

echo "==> Installing ginkgo CLI..."
if command -v ginkgo &> /dev/null; then
    echo "    ginkgo already installed: $(ginkgo version 2>&1)"
else
    # Check if Go bin is in PATH
    GOBIN="${GOBIN:-$(go env GOPATH)/bin}"
    if [[ -x "$GOBIN/ginkgo" ]]; then
        echo "    ginkgo installed at $GOBIN/ginkgo (add to PATH)"
    else
        go install github.com/onsi/ginkgo/v2/ginkgo@latest 2>/dev/null || echo "    ginkgo install skipped (network unavailable)"
    fi
fi

echo "==> Bootstrap complete!"
